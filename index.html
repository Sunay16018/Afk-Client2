<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>7/24 Bot Master</title>
    <style>
        :root { --bg: #0d1117; --panel: #161b22; --border: #30363d; --accent: #238636; --text: #c9d1d9; --blue: #58a6ff; }
        * { box-sizing: border-box; }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* NAVƒ∞GASYON */
        nav { display: flex; background: var(--panel); border-bottom: 1px solid var(--border); height: 50px; flex-shrink: 0; }
        nav button { flex: 1; background: none; border: none; color: #8b949e; font-weight: bold; font-size: 13px; cursor: pointer; transition: 0.2s; }
        nav button.active { color: var(--blue); border-bottom: 3px solid var(--blue); background: rgba(88, 166, 255, 0.1); }

        /* SEKMELER */
        .tab { flex: 1; display: none; padding: 15px; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .active-tab { display: block; }

        /* LOG KUTUSU */
        #logbox { background: #010409; height: 60vh; overflow-y: auto; padding: 10px; font-size: 12px; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 10px; font-family: monospace; line-height: 1.5; word-wrap: break-word; }
        
        /* INPUTLAR */
        input, select { background: var(--panel); border: 1px solid var(--border); color: white; padding: 12px; border-radius: 6px; width: 100%; margin-bottom: 10px; font-size: 16px; outline: none; }
        input:focus { border-color: var(--blue); }

        /* BUTONLAR */
        .btn { width: 100%; padding: 14px; border: none; border-radius: 6px; font-weight: bold; font-size: 15px; cursor: pointer; color: white; margin-bottom: 5px; }
        .btn-green { background: var(--accent); }
        .btn-blue { background: var(--blue); }
        .btn-red { background: #da3633; }

        /* ENVANTER & KORDƒ∞NAT */
        .coord-box { display: flex; gap: 5px; margin-bottom: 10px; }
        .inv-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 4px; }
        .slot { background: #21262d; border: 1px solid var(--border); aspect-ratio: 1; border-radius: 4px; display: flex; align-items: center; justify-content: center; position: relative; cursor: pointer; }
        .slot img { width: 80%; pointer-events: none; }
        .count { position: absolute; bottom: 1px; right: 2px; font-size: 10px; font-weight: bold; background: rgba(0,0,0,0.8); padding: 0 3px; border-radius: 2px; color: #fff; }

        /* BOT Lƒ∞STESƒ∞ */
        .bot-item { padding: 12px; background: var(--panel); border: 1px solid var(--border); border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .bot-item.selected { border-color: var(--blue); box-shadow: 0 0 5px rgba(88, 166, 255, 0.3); }
        .status-dot { width: 10px; height: 10px; background: #238636; border-radius: 50%; display: inline-block; margin-right: 8px; }
    </style>
</head>
<body>

<nav>
    <button onclick="T('home')" id="n-home" class="active">BAƒûLANTI</button>
    <button onclick="T('logs')" id="n-logs">LOGLAR</button>
    <button onclick="T('ctrl')" id="n-ctrl">KONTROL</button>
</nav>

<div id="t-home" class="tab active-tab">
    <h3 style="margin: 0 0 10px 0; color: var(--blue);">YENƒ∞ BOT EKLE</h3>
    <input id="host" placeholder="Sunucu IP Adresi">
    <input id="user" placeholder="Kullanƒ±cƒ± Adƒ±">
    <select id="ver">
        <option value="1.20.1">S√ºr√ºm: 1.20.1</option>
        <option value="1.16.5">S√ºr√ºm: 1.16.5</option>
        <option value="1.8.9">S√ºr√ºm: 1.8.9</option>
        <option value="1.21.1">S√ºr√ºm: 1.21.1</option>
    </select>
    <button class="btn btn-green" onclick="start()">BAƒûLAN VE Sƒ∞STEME EKLE</button>
    
    <div style="border-top: 1px solid var(--border); margin: 20px 0;"></div>
    
    <h3 style="margin: 0 0 10px 0; color: #8b949e;">AKTƒ∞F BOTLAR</h3>
    <div id="botList"></div>
</div>

<div id="t-logs" class="tab">
    <div id="logbox"></div>
    <div style="display:flex; gap:5px;">
        <input id="chatInput" placeholder="Mesaj g√∂nder..." onkeydown="if(event.key==='Enter') sendChat()" style="margin:0">
        <button class="btn btn-blue" onclick="sendChat()" style="width: 60px; margin:0;">‚û§</button>
    </div>
</div>

<div id="t-ctrl" class="tab">
    <div id="stats" style="text-align: center; margin-bottom: 15px; font-weight: bold; color: var(--accent);">Se√ßili bot yok</div>
    
    <label style="font-size: 12px; color: #8b949e; font-weight: bold;">KOORDƒ∞NATA Gƒ∞T</label>
    <div class="coord-box">
        <input id="cx" type="number" placeholder="X">
        <input id="cy" type="number" placeholder="Y">
        <input id="cz" type="number" placeholder="Z">
    </div>
    <button class="btn btn-blue" onclick="goCoord()">Y√úR√ú</button>

    <label style="font-size: 12px; color: #8b949e; font-weight: bold; margin-top: 15px; display: block;">ENVANTER (TIKLA = AT)</label>
    <div id="inv" class="inv-grid"></div>
</div>

<script>
    // Tarayƒ±cƒ±ya √∂zel benzersiz ID olu≈ütur (Session ID)
    let sid = localStorage.getItem('unique_sid') || 'uid_' + Date.now();
    localStorage.setItem('unique_sid', sid);
    
    let selectedBot = "";
    let lastLogLength = 0;

    function T(name) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active-tab'));
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        document.getElementById('t-' + name).classList.add('active-tab');
        document.getElementById('n-' + name).classList.add('active');
    }

    async function start() {
        const h = document.getElementById('host').value;
        const u = document.getElementById('user').value;
        const v = document.getElementById('ver').value;
        if (!h || !u) return alert("L√ºtfen IP ve Kullanƒ±cƒ± Adƒ± girin!");
        
        await fetch(`/start?sid=${sid}&host=${h}&port=25565&user=${u}&ver=${v}&auto=true`);
        selectedBot = u;
        T('logs'); // Log ekranƒ±na ge√ß
    }

    async function sendChat() {
        const txt = document.getElementById('chatInput');
        if (!txt.value || !selectedBot) return;
        await fetch(`/send?sid=${sid}&user=${selectedBot}&msg=${encodeURIComponent(txt.value)}`);
        txt.value = "";
    }

    async function goCoord() {
        const x = document.getElementById('cx').value;
        const y = document.getElementById('cy').value;
        const z = document.getElementById('cz').value;
        if (x && y && z && selectedBot) {
            await fetch(`/goto?sid=${sid}&user=${selectedBot}&x=${x}&y=${y}&z=${z}`);
        }
    }

    async function stopBot(name) {
        if(confirm(name + " botunu durdurmak istediƒüine emin misin?")) {
            await fetch(`/stop?sid=${sid}&user=${name}`);
        }
    }

    // Veri G√ºncelleme D√∂ng√ºs√º (1 saniyede bir)
    setInterval(async () => {
        try {
            const res = await fetch(`/data?sid=${sid}&user=${selectedBot}`);
            const data = await res.json();

            // 1. Bot Listesini G√ºncelle
            const listDiv = document.getElementById('botList');
            if (data.active.length === 0) {
                listDiv.innerHTML = "<small style='color:#8b949e'>Aktif bot yok.</small>";
            } else {
                listDiv.innerHTML = data.active.map(name => `
                    <div class="bot-item ${selectedBot === name ? 'selected' : ''}" onclick="selectedBot='${name}'">
                        <div><span class="status-dot"></span><b>${name}</b></div>
                        <button onclick="event.stopPropagation(); stopBot('${name}')" style="background:#da3633; color:white; border:none; padding:5px 10px; border-radius:4px; font-size:11px;">KES</button>
                    </div>
                `).join('');
            }

            // 2. Se√ßili Bot Varsa Loglarƒ± ve Verileri G√ºncelle
            if (selectedBot && data.logs[selectedBot]) {
                const logs = data.logs[selectedBot];
                const box = document.getElementById('logbox');
                
                // Sadece yeni log varsa DOM g√ºncelle (Performans i√ßin)
                if (logs.length !== lastLogLength || box.innerHTML === "") {
                    box.innerHTML = logs.join('');
                    box.scrollTop = box.scrollHeight;
                    lastLogLength = logs.length;
                }

                if (data.botData) {
                    // ƒ∞statistikler
                    const hp = Math.round(data.botData.hp * 5); // % hesabƒ±
                    const food = Math.round(data.botData.food);
                    document.getElementById('stats').innerHTML = 
                        `<span style="color:#ff7b72">‚ù§ %${hp}</span> | <span style="color:#d2a8ff">üçñ ${food}</span>`;

                    // Envanter
                    const invDiv = document.getElementById('inv');
                    invDiv.innerHTML = data.botData.inv.map(item => `
                        <div class="slot" onclick="fetch('/drop?sid=${sid}&user=${selectedBot}&slot=${item.slot}')">
                            <img src="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.16.1/items/${item.name}.png" onerror="this.style.display='none'">
                            <span class="count">${item.count}</span>
                        </div>
                    `).join('');
                }
            }
        } catch (e) { console.error("Veri √ßekme hatasƒ±:", e); }
    }, 1000);
</script>

</body>
    </html>
    
