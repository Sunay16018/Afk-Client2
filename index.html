<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Gece Loglu Bot Panel</title>
    <style>
        * { box-sizing: border-box; }
        body { background: #0d1117; color: #c9d1d9; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        nav { display: flex; background: #161b22; border-bottom: 1px solid #30363d; flex-shrink: 0; }
        nav button { flex: 1; padding: 15px 5px; border: none; background: none; color: #8b949e; font-weight: bold; font-size: 13px; cursor: pointer; }
        nav button.active { color: #58a6ff; border-bottom: 2px solid #58a6ff; background: #1c2128; }
        .tab { flex: 1; display: none; padding: 12px; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .active-tab { display: block; }
        
        /* LOG EKRANI GÃœNCELLEMESÄ° */
        #logbox { background: #000; height: 60vh; overflow-y: auto; padding: 10px; font-size: 13px; border-radius: 8px; border: 1px solid #30363d; margin-bottom: 10px; line-height: 1.5; word-wrap: break-word; }
        
        input, select { background: #0d1117; border: 1px solid #30363d; color: #fff; padding: 12px; border-radius: 8px; width: 100%; margin-bottom: 10px; font-size: 16px; outline: none; }
        .inv-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .slot { background: #1c2128; border: 1px solid #444c56; aspect-ratio: 1; border-radius: 8px; display: flex; align-items: center; justify-content: center; position: relative; }
        .slot img { width: 75%; }
        .count { position: absolute; bottom: 2px; right: 4px; font-size: 11px; font-weight: bold; background: rgba(0,0,0,0.7); padding: 0 4px; border-radius: 4px; color: #fff; }
        .btn { background: #238636; color: #fff; border: none; padding: 15px; width: 100%; border-radius: 8px; font-weight: bold; font-size: 16px; cursor: pointer; }
        #blist div { padding: 12px; background: #1c2128; border-radius: 8px; margin-bottom: 8px; border: 1px solid #30363d; }
    </style>
</head>
<body>
    <nav>
        <button onclick="T('bot')" id="n-bot" class="active">BOT YÃ–NETÄ°M</button>
        <button onclick="T('chat')" id="n-chat">GECE LOGLARI</button>
        <button onclick="T('inv')" id="n-inv">Ã‡ANTA</button>
    </nav>

    <div id="t-bot" class="tab active-tab">
        <input id="host" placeholder="Sunucu IP (Ã–rn: oyna.server.com)">
        <input id="user" placeholder="Bot Ä°smi">
        <select id="ver"><option value="1.20.1">1.20.1</option><option value="1.8.9">1.8.9</option></select>
        <button class="btn" onclick="start()">SÄ°STEMÄ° BAÅžLAT</button>
        <h4 style="margin: 15px 0 10px 0; color: #8b949e;">Aktif Botlar:</h4>
        <div id="blist"></div>
    </div>

    <div id="t-chat" class="tab">
        <div id="logbox"></div>
        <div style="display:flex; gap:8px;">
            <input id="mi" placeholder="Mesaj veya /goto x y z" onkeydown="if(event.key==='Enter') send()" style="margin-bottom:0">
            <button onclick="send()" style="background:#238636; border:none; color:white; border-radius:8px; width:50px;">âž¤</button>
        </div>
    </div>

    <div id="t-inv" class="tab">
        <div id="stat" style="text-align:center; font-weight:bold; color:#2ecc71; margin-bottom:15px;"></div>
        <div class="inv-grid" id="inv-display"></div>
        <p style="font-size:11px; color:#8b949e; text-align:center; margin-top:20px;">EÅŸyaya dokunursan hepsini yere atar.</p>
    </div>

    <script>
        // SID sabit kalmalÄ± ki loglar eÅŸleÅŸsin
        let sid = localStorage.getItem('bot_sid') || 's_'+Math.random().toString(36).substr(2,9);
        localStorage.setItem('bot_sid', sid);
        
        let sel = ""; 
        let lastLogCount = 0;

        function T(t){
            document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active-tab'));
            document.querySelectorAll('nav button').forEach(x=>x.classList.remove('active'));
            document.getElementById('t-'+t).classList.add('active-tab');
            document.getElementById('n-'+t).classList.add('active');
        }

        function start(){
            const h=document.getElementById('host').value, u=document.getElementById('user').value, v=document.getElementById('ver').value;
            fetch(`/start?sid=${sid}&host=${h}&port=25565&user=${u}&ver=${v}&auto=true`);
            sel = u; T('chat');
        }

        function send(){
            const i=document.getElementById('mi');
            if(!i.value || !sel) return;
            fetch(`/send?sid=${sid}&user=${sel}&msg=${encodeURIComponent(i.value)}`);
            i.value="";
        }

        setInterval(async ()=>{
            try {
                const r = await fetch(`/data?sid=${sid}&user=${sel}`);
                const d = await r.json();
                
                document.getElementById('blist').innerHTML = d.active.map(n=>`
                    <div onclick="sel='${n}'" style="border-color:${sel==n?'#58a6ff':'#30363d'}">
                        ${n} ${sel==n?'<small>(SeÃ§ili)</small>':''}
                    </div>
                `).join('');

                if(sel && d.logs[sel]) {
                    const lb = document.getElementById('logbox');
                    // Sadece yeni mesaj varsa veya ilk aÃ§Ä±lÄ±ÅŸta gÃ¼ncelle
                    if(d.logs[sel].length !== lastLogCount) {
                        lb.innerHTML = d.logs[sel].join('<br>');
                        lb.scrollTop = lb.scrollHeight;
                        lastLogCount = d.logs[sel].length;
                    }
                    
                    if(d.botData){
                        document.getElementById('stat').innerText = `â¤ï¸ HP: ${Math.round(d.botData.hp)} | ðŸ– AÃ§lÄ±k: ${Math.round(d.botData.food)}`;
                        document.getElementById('inv-display').innerHTML = d.botData.inv.map(i=>`
                            <div class="slot" onclick="fetch('/drop?sid=${sid}&user=${sel}&slot=${i.slot}')">
                                <img src="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.16.1/items/${i.name}.png">
                                <span class="count">${i.count}</span>
                            </div>
                        `).join('');
                    }
                }
            } catch(e){}
        }, 1500);
    </script>
</body>
</html>
