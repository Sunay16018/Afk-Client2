<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AFK Client Fix</title>
    <style>
        * { box-sizing: border-box; font-family: sans-serif; font-size: 13px; }
        body { background: #0d1117; color: #c9d1d9; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        nav { display: flex; background: #161b22; border-bottom: 1px solid #30363d; height: 45px; flex-shrink: 0; }
        nav button { flex: 1; border: none; background: none; color: #8b949e; cursor: pointer; font-weight: bold; }
        nav button.active { color: #2ecc71; border-bottom: 2px solid #2ecc71; }
        .tab { display: none; flex: 1; padding: 10px; overflow-y: auto; flex-direction: column; }
        .active-tab { display: flex; }
        
        /* ORTA BOY KONSOL */
        #logbox { height: 250px; background: #000; color: #2ecc71; padding: 10px; overflow-y: auto; font-family: monospace; border-radius: 5px; border: 1px solid #30363d; margin-bottom: 10px; flex-shrink: 0; }

        /* ENVANTER GUI */
        .inv-grid { display: grid; grid-template-columns: repeat(9, 1fr); gap: 4px; background: #8b8b8b; padding: 10px; border: 3px solid #373737; border-radius: 2px; width: fit-content; margin: 0 auto; }
        .slot { width: 34px; height: 34px; background: #8b8b8b; border: 2px solid #373737; position: relative; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .slot:hover { background: #c6c6c6; }
        .slot img { width: 28px; height: 28px; image-rendering: pixelated; }
        .count { position: absolute; bottom: 1px; right: 2px; font-size: 10px; color: white; text-shadow: 1px 1px #000; font-weight: bold; }

        .bot-row { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #161b22; border: 1px solid #30363d; margin-top: 8px; border-radius: 8px; }
        .btn { padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; background: #1f6feb; }
        input { background: #010409; border: 1px solid #30363d; color: #fff; padding: 10px; border-radius: 6px; width: 100%; }
        
        /* YENƒ∞ EKLENEN STILLER */
        .movement-controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 20px auto; max-width: 300px; }
        .movement-btn { padding: 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: white; background: #238636; font-size: 16px; }
        .movement-btn:hover { opacity: 0.9; }
        .movement-btn:active { transform: scale(0.95); }
        #btn-jump { grid-column: 2; grid-row: 2; }
        
        .settings-section { background: #161b22; padding: 15px; border-radius: 8px; border: 1px solid #30363d; margin-bottom: 15px; }
        .settings-title { color: #2ecc71; margin-top: 0; margin-bottom: 10px; }
        
        .toggle-switch { position: relative; display: inline-block; width: 60px; height: 34px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #30363d; transition: .4s; border-radius: 34px; }
        .toggle-slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .toggle-slider { background-color: #2ecc71; }
        input:checked + .toggle-slider:before { transform: translateX(26px); }
    </style>
</head>
<body>
    <nav>
        <button onclick="tab('bots')" id="btn-bots" class="active">BOTLAR</button>
        <button onclick="tab('term')" id="btn-term">KONSOL</button>
        <button onclick="tab('inv')" id="btn-inv">ENVANTER</button>
        <button onclick="tab('settings')" id="btn-settings">AYARLAR</button>
    </nav>

    <div id="tab-bots" class="tab active-tab">
        <div style="background: #161b22; padding: 15px; border-radius: 8px; border: 1px solid #30363d;">
            <input id="h" placeholder="IP:Port" style="margin-bottom:5px;">
            <input id="u" placeholder="ƒ∞sim" style="margin-bottom:5px;">
            <input id="v" placeholder="S√ºr√ºm (1.16.5)" style="margin-bottom:10px;">
            <button class="btn" style="width:100%; background:#238636;" onclick="add()">BAƒûLAN</button>
        </div>
        <div id="list"></div>
    </div>

    <div id="tab-term" class="tab">
        <div id="logbox"></div>
        <form onsubmit="doSend(event)" style="display:flex; gap:5px;">
            <input id="m" placeholder="Mesaj..." autocomplete="off">
            <button type="submit" class="btn">G√ñNDER</button>
        </form>
    </div>

    <div id="tab-inv" class="tab">
        <div id="stats" style="text-align:center; margin-bottom:10px;">‚ù§Ô∏è - | üçñ -</div>
        <div class="inv-grid" id="inv-box"></div>
    </div>

    <div id="tab-settings" class="tab">
        <!-- Kazma Modu -->
        <div class="settings-section">
            <h3 class="settings-title">üî® AKILLI KAZMA MODU</h3>
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                <span>Kazma Modu:</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="digging-toggle" onchange="toggleDigging()">
                    <span class="toggle-slider"></span>
                </label>
                <span id="digging-status" style="color: #8b949e;">Kapalƒ±</span>
            </div>
            <div style="color: #8b949e; font-size: 12px;">
                A√ßƒ±ldƒ±ƒüƒ±nda bot √∂n√ºndeki bloƒüu otomatik kƒ±racak. Blok kƒ±rƒ±lƒ±nca duracak.
            </div>
        </div>

        <!-- Hareket Kontrolleri -->
        <div class="settings-section">
            <h3 class="settings-title">üéÆ HAREKET KONTROLLERƒ∞</h3>
            <div class="movement-controls">
                <div></div>
                <button class="movement-btn" onmousedown="startMove('forward')" onmouseup="stopMove('forward')" ontouchstart="startMove('forward')" ontouchend="stopMove('forward')">ƒ∞LERƒ∞</button>
                <div></div>
                <button class="movement-btn" onmousedown="startMove('left')" onmouseup="stopMove('left')" ontouchstart="startMove('left')" ontouchend="stopMove('left')">SOL</button>
                <button class="movement-btn" onmousedown="startMove('back')" onmouseup="stopMove('back')" ontouchstart="startMove('back')" ontouchend="stopMove('back')">GERƒ∞</button>
                <button class="movement-btn" onmousedown="startMove('right')" onmouseup="stopMove('right')" ontouchstart="startMove('right')" ontouchend="stopMove('right')">SAƒû</button>
                <button class="movement-btn" id="btn-jump" onclick="jump()">ZIPLA</button>
            </div>
            <div style="color: #8b949e; font-size: 12px; text-align: center; margin-top: 10px;">
                Tu≈ülara basƒ±lƒ± tutarak hareket ettirebilirsiniz.
            </div>
        </div>

        <!-- Ek Ayarlar -->
        <div class="settings-section">
            <h3 class="settings-title">‚öôÔ∏è Dƒ∞ƒûER AYARLAR</h3>
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                <span>Otomatik Yeniden Baƒülanma:</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="reconnect-toggle" onchange="toggleReconnect()">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <span>Anti-AFK Modu:</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="antiafk-toggle" onchange="toggleAntiAFK()">
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>
    </div>

    <script>
        if(!localStorage.getItem('sid')) localStorage.setItem('sid', 'sid_'+Math.random().toString(36).substr(2,9));
        const mySID = localStorage.getItem('sid');
        let sel = "";
        let digInterval = null;
        let moveInterval = null;

        function tab(t) {
            document.querySelectorAll('.tab').forEach(x => x.classList.remove('active-tab'));
            document.querySelectorAll('nav button').forEach(x => x.classList.remove('active'));
            document.getElementById('tab-'+t).classList.add('active-tab');
            document.getElementById('btn-'+t).classList.add('active');
        }

        async function add() {
            const h = document.getElementById('h').value, u = document.getElementById('u').value, v = document.getElementById('v').value;
            if(!h || !u || !v) return alert("L√ºtfen t√ºm alanlarƒ± doldurun!");
            await fetch(`/start?sid=${mySID}&host=${h}&user=${u}&ver=${v}`);
            sel = u; tab('term');
        }

        async function doSend(e) {
            if(e) e.preventDefault();
            const i = document.getElementById('m');
            if(!sel || !i.value) return;
            await fetch(`/send?sid=${mySID}&user=${sel}&msg=${encodeURIComponent(i.value)}`);
            i.value = "";
        }

        async function dropItem(slot) {
            if(confirm("E≈üyayƒ± atmak istiyor musun?"))
                await fetch(`/update?sid=${mySID}&user=${sel}&type=inv&status=drop&val=${slot}`);
        }

        // KAZMA FONKSƒ∞YONLARI
        async function toggleDigging() {
            const toggle = document.getElementById('digging-toggle');
            const status = document.getElementById('digging-status');
            
            if(!sel) {
                alert("√ñnce bir bot se√ßin!");
                toggle.checked = false;
                return;
            }
            
            if(toggle.checked) {
                // Kazmayƒ± ba≈ülat
                await fetch(`/dig?sid=${mySID}&user=${sel}&action=start`);
                status.textContent = "A√ßƒ±k";
                status.style.color = "#2ecc71";
            } else {
                // Kazmayƒ± durdur
                await fetch(`/dig?sid=${mySID}&user=${sel}&action=stop`);
                status.textContent = "Kapalƒ±";
                status.style.color = "#8b949e";
            }
        }

        // HAREKET FONKSƒ∞YONLARI
        async function startMove(direction) {
            if(!sel) return;
            await fetch(`/control?sid=${mySID}&user=${sel}&direction=${direction}&state=true`);
        }

        async function stopMove(direction) {
            if(!sel) return;
            await fetch(`/control?sid=${mySID}&user=${sel}&direction=${direction}&state=false`);
        }

        async function jump() {
            if(!sel) return;
            // Zƒ±plama i√ßin kƒ±sa s√ºreli aktivasyon
            await fetch(`/control?sid=${mySID}&user=${sel}&direction=jump&state=true`);
            setTimeout(() => {
                fetch(`/control?sid=${mySID}&user=${sel}&direction=jump&state=false`);
            }, 200);
        }

        // Dƒ∞ƒûER AYARLAR
        async function toggleReconnect() {
            const toggle = document.getElementById('reconnect-toggle');
            await fetch(`/update?sid=${mySID}&user=${sel}&type=setting&setting=reconnect&value=${toggle.checked}`);
        }

        async function toggleAntiAFK() {
            const toggle = document.getElementById('antiafk-toggle');
            await fetch(`/update?sid=${mySID}&user=${sel}&type=setting&setting=antiafk&value=${toggle.checked}`);
        }

        // VERƒ∞ G√úNCELLEME
        setInterval(async () => {
            try {
                const r = await fetch(`/data?sid=${mySID}&user=${sel}`);
                const d = await r.json();
                
                // Bot listesini g√ºncelle
                document.getElementById('list').innerHTML = d.active.map(n => `
                    <div class="bot-row" style="border-color:${sel==n?'#2ecc71':'#30363d'}" onclick="sel='${n}'; updateUI();">
                        <span>${n} ${sel==n?'(SE√áƒ∞Lƒ∞)':''}</span>
                        <button class="btn" style="background:#da3633; padding:5px 10px;" onclick="event.stopPropagation(); fetch('/stop?sid=${mySID}&user=${n}')">KES</button>
                    </div>
                `).join('');

                // Se√ßili bot varsa verileri g√ºncelle
                if(sel && d.logs[sel]) {
                    const lb = document.getElementById('logbox');
                    lb.innerHTML = d.logs[sel].join('<br>');
                    lb.scrollTop = lb.scrollHeight;

                    if(d.botData[sel]) {
                        const bd = d.botData[sel];
                        document.getElementById('stats').innerText = `‚ù§Ô∏è ${Math.round(bd.hp || 0)} | üçñ ${Math.round(bd.food || 0)}`;
                        let invH = "";
                        for(let i=0; i<45; i++) {
                            const it = bd.inv.find(x => x.slot === i);
                            invH += `<div class="slot" onclick="dropItem(${i})">
                                ${it ? `<img src="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.16.1/items/${it.name}.png" onerror="this.src='https://minecraft.wiki/images/Barrier_JE2_BE2.png'"><span class="count">${it.count>1?it.count:''}</span>` : ''}
                            </div>`;
                        }
                        document.getElementById('inv-box').innerHTML = invH;
                    }
                } else if (sel && !d.active.includes(sel)) {
                    sel = ""; // Bot d√º≈üt√ºyse se√ßimi sƒ±fƒ±rla
                }
            } catch(e) {
                console.error("Veri g√ºncelleme hatasƒ±:", e);
            }
        }, 1000);

        function updateUI() {
            // UI g√ºncellemeleri burada yapƒ±labilir
        }
    </script>
</body>
</html>