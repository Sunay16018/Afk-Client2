<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BotMaster Ultimate Proxy</title>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --border: #30363d; --acc: #238636; --act: #2ecc71; --blue: #58a6ff; --red: #da3633; }
        body { background: var(--bg); color: #c9d1d9; font-family: 'Segoe UI', sans-serif; margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        nav { display: flex; background: var(--card); border-bottom: 1px solid var(--border); flex-shrink: 0; }
        nav button { flex: 1; padding: 15px; border: none; background: none; color: #8b949e; cursor: pointer; font-weight: bold; border-bottom: 3px solid transparent; }
        nav button.active { color: var(--blue); border-bottom: 3px solid var(--blue); background: #21262d; }
        
        .tab { flex: 1; display: none; flex-direction: column; padding: 15px; overflow-y: auto; }
        .active-tab { display: flex; }
        
        #logbox { flex: 1; background: #000; border: 1px solid var(--border); border-radius: 6px; padding: 10px; font-family: 'Consolas', monospace; overflow-y: auto; margin-bottom: 10px; font-size: 13px; white-space: pre-wrap; word-wrap: break-word; }
        
        .row { background: var(--card); border: 1px solid var(--border); padding: 10px; border-radius: 6px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        
        .m-grid { display: grid; grid-template-columns: repeat(3, 70px); gap: 10px; justify-content: center; margin: 20px 0; }
        .m-btn { width: 70px; height: 70px; background: var(--card); border: 2px solid var(--border); color: white; border-radius: 12px; font-weight: bold; cursor: pointer; }
        .m-btn.on { background: var(--act); color: #000; box-shadow: 0 0 10px var(--act); border-color: white; }
        
        .inv-grid { display: grid; grid-template-columns: repeat(9, 36px); gap: 4px; background: #333; padding: 5px; border-radius: 5px; width: fit-content; margin: 0 auto; }
        .slot { width: 34px; height: 34px; background: #8b8b8b; border: 1px solid #373737; display: flex; align-items: center; justify-content: center; position: relative; }
        .slot img { width: 28px; }
        .count { position: absolute; bottom: 0; right: 0; color: white; font-size: 10px; text-shadow: 1px 1px 0 #000; }
        
        input, select { background: var(--bg); border: 1px solid var(--border); color: white; padding: 10px; border-radius: 6px; margin-bottom: 5px; width: 100%; box-sizing: border-box; }
        .btn-green { background: var(--acc); color: white; padding: 12px; border: none; border-radius: 6px; width: 100%; font-weight: bold; cursor: pointer; }
        .btn-red { background: var(--red); color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .input-group { display: flex; gap: 5px; }
    </style>
</head>
<body>

<nav>
    <button onclick="T('bots')" id="n-bots" class="active">BOTLAR</button>
    <button onclick="T('chat')" id="n-chat">CHAT</button>
    <button onclick="T('ctrl')" id="n-ctrl">KONTROL</button>
    <button onclick="T('spam')" id="n-spam">SPAM</button>
</nav>

<div id="t-bots" class="tab active-tab">
    <div class="input-group">
        <input id="host" placeholder="Sunucu IP">
        <input id="port" placeholder="25565" style="width:100px">
    </div>
    <input id="user" placeholder="Bot ƒ∞smi">
    <select id="ver"><option value="1.21.1">1.21.1</option><option value="1.20.1">1.20.1</option><option value="1.8.9">1.8.9</option></select>
    <div class="row"><span>Akƒ±llƒ± Proxy Yeniden Baƒülan</span><input type="checkbox" id="ar" style="width:20px; height:20px;"></div>
    <button class="btn-green" onclick="connect()">BAƒûLANTIDAKƒ∞ T√úNELƒ∞ A√á</button>
    <div id="blist" style="margin-top:15px"></div>
</div>

<div id="t-chat" class="tab">
    <div id="logbox"></div>
    <div class="input-group">
        <input id="mi" placeholder="Mesaj yaz..." onkeydown="if(event.key==='Enter') sendM()">
        <button class="btn-green" style="width:80px" onclick="sendM()">‚û§</button>
    </div>
</div>

<div id="t-ctrl" class="tab">
    <div id="stat" style="text-align:center; margin-bottom:10px; color:var(--act); font-weight:bold;">Veri Bekleniyor...</div>
    
    <div class="m-grid">
        <div></div><button class="m-btn" id="b-forward" onclick="M('forward')">W</button><div></div>
        <button class="m-btn" id="b-left" onclick="M('left')">A</button>
        <button class="m-btn" id="b-jump" onclick="M('jump')">ZIP</button>
        <button class="m-btn" id="b-right" onclick="M('right')">D</button>
        <div></div><button class="m-btn" id="b-back" onclick="M('back')">S</button><div></div>
    </div>
    
    <div class="inv-grid" id="inv"></div>
</div>

<div id="t-spam" class="tab">
    <div class="row"><b>SPAM MOTORU</b><input type="checkbox" id="so" onchange="SpT(this.checked)" style="width:20px; height:20px;"></div>
    <input id="sm" placeholder="Spam metni">
    <input id="sd" type="number" value="5" min="1">
    <button class="btn-green" onclick="SpA()">Lƒ∞STEYE EKLE</button>
    <div id="slist" style="margin-top:15px"></div>
</div>

<script>
    const sid = localStorage.getItem('sid') || 's_'+Math.random().toString(36).substr(2,9);
    localStorage.setItem('sid', sid);
    let sel = "", moves = {}, autoScroll = true;

    // Konsol Scroll Mantƒ±ƒüƒ±
    const lb = document.getElementById('logbox');
    lb.onscroll = () => { autoScroll = (lb.scrollHeight - lb.scrollTop <= lb.clientHeight + 50); };

    function T(n) {
        document.querySelectorAll('.tab').forEach(x => x.classList.remove('active-tab'));
        document.querySelectorAll('nav button').forEach(x => x.classList.remove('active'));
        document.getElementById('t-'+n).classList.add('active-tab');
        document.getElementById('n-'+n).classList.add('active');
    }

    async function connect() {
        const h=document.getElementById('host').value, p=document.getElementById('port').value, 
              u=document.getElementById('user').value, v=document.getElementById('ver').value, a=document.getElementById('ar').checked;
        if(!h || !u) return;
        await fetch(`/start?sid=${sid}&host=${h}&port=${p}&user=${u}&ver=${v}&auto=${a}`);
        sel = u; T('chat');
    }

    async function sendM() {
        const i=document.getElementById('mi');
        if(!sel || !i.value) return;
        await fetch(`/send?sid=${sid}&user=${sel}&msg=${encodeURIComponent(i.value)}`);
        i.value = "";
    }

    async function M(d) {
        if(!sel) return;
        moves[d] = !moves[d];
        document.getElementById('b-'+d).classList.toggle('on', moves[d]);
        await fetch(`/move?sid=${sid}&user=${sel}&dir=${d}&state=${moves[d]}`);
    }

    async function SpT(s) { if(!sel) return; await fetch(`/tglspam?sid=${sid}&user=${sel}&state=${s}`); }
    async function SpA() {
        const m=document.getElementById('sm').value, d=document.getElementById('sd').value;
        if(!sel || !m) return;
        await fetch(`/addspam?sid=${sid}&user=${sel}&msg=${encodeURIComponent(m)}&delay=${d}`);
        document.getElementById('sm').value = "";
    }

    setInterval(async () => {
        try {
            const r = await fetch(`/data?sid=${sid}&user=${sel}`);
            const d = await r.json();

            // Bot Listesi ve KES butonu
            document.getElementById('blist').innerHTML = d.active.map(n => `
                <div class="row" style="border-color:${sel==n?'var(--blue)':'var(--border)'}" onclick="sel='${n}'">
                    <span>${n} ${sel==n?'(Aktif)':''}</span>
                    <button class="btn-red" onclick="event.stopPropagation(); fetch('/stop?sid=${sid}&user=${n}')">KES</button>
                </div>
            `).join('');

            if(sel && d.logs[sel]) {
                lb.innerHTML = d.logs[sel].join('<br>');
                if(autoScroll) lb.scrollTop = lb.scrollHeight;

                if(d.botData) {
                    const b = d.botData;
                    document.getElementById('stat').innerText = `‚ù§Ô∏è ${Math.round(b.hp)} | üçñ ${Math.round(b.food)}`;
                    document.getElementById('so').checked = b.spamOn;

                    // Envanter
                    let ih = "";
                    for(let i=0; i<45; i++) {
                        const it = b.inv.find(x => x.slot === i);
                        ih += `<div class="slot">${it ? `<img src="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.16.1/items/${it.name}.png"><span class="count">${it.count>1?it.count:''}</span>` : ''}</div>`;
                    }
                    document.getElementById('inv').innerHTML = ih;

                    // Spam Listesi
                    document.getElementById('slist').innerHTML = b.spams.map(s => `
                        <div class="row">
                            <span>${s.msg} (${s.delay}s)</span>
                            <button class="btn-red" onclick="fetch('/delspam?sid=${sid}&user=${sel}&id=${s.id}')">Sƒ∞L</button>
                        </div>
                    `).join('');
                }
            }
        } catch(e) {}
    }, 1000);
</script>
</body>
</html>
